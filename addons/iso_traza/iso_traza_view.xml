<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
    	
    	<!-- Location -->
    	
		<record id="view_location_form_traza" model="ir.ui.view">
            <field name="name">stock.location.form.traza</field>
            <field name="model">stock.location</field>
            <field name="inherit_id" ref="stock.view_location_form" />
            <field name="type">form</field>
            <field name="arch" type="xml">
                <xpath expr="/form/group/field[@name='location_id']" position="after">
	                <field name="polvorin"/>
	            </xpath>
	            <xpath expr="/form/group/field[@name='location_id']" position="after">
	                <field name="obra"/>
	            </xpath>
            </field>
        </record>
        
        <record id="view_location_search_traza" model="ir.ui.view">
            <field name="name">stock.location.search.traza</field>
            <field name="model">stock.location</field>
            <field name="inherit_id" ref="stock.view_location_search" />
            <field name="type">search</field>
            <field name="arch" type="xml">
            	<xpath expr="/search/filter[@name='supplier']" position="after">
	                <filter icon="terp-personal" name="polvorines" string="Polvorines" domain="[('polvorin', '=', True)]"/>
	            </xpath>
            	<xpath expr="/search/filter[@name='supplier']" position="after">
	                <filter icon="terp-personal" name="obras" string="Obras" domain="[('obra', '=', True)]"/>
	            </xpath>
            </field>
        </record>


        <record id="view_location_tree2_traza" model="ir.ui.view">
            <field name="name">stock.location.tree.traza</field>
            <field name="model">stock.location</field>
            <field name="inherit_id" ref="stock.view_location_tree2" />
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <xpath expr="/tree/field[@name='usage']" position="after">
	                <field name="polvorin"/>
	            </xpath>     
                <xpath expr="/tree/field[@name='usage']" position="after">
	                <field name="obra"/>
	            </xpath>
            </field>
        </record>
    		        
        <!-- Tracking -->
        
        <record id="view_tracking_form_traza" model="ir.ui.view">
            <field name="name">stock.tracking.form.traza</field>
            <field name="model">stock.tracking</field>
            <field name="inherit_id" ref="stock.view_tracking_form" />
            <field name="type">form</field>
            <field name="arch" type="xml">
                <xpath expr="/form/group/field[@name='date']" position="after">
	                <field name="parent_id"/>
	            </xpath>
	            <xpath expr="/form/group/field[@name='date']" position="after">
	                <field name="nivel"/>
	            </xpath>
	            <xpath expr="/form/group/field[@name='serial']" position="replace"/>
	            <xpath expr="/form/group/field[@name='active']" position="replace"/>
            </field>
        </record>
        
        <record id="view_tracking_tree_traza" model="ir.ui.view">
            <field name="name">stock.tracking.tree.traza</field>
            <field name="model">stock.tracking</field>
            <field name="inherit_id" ref="stock.view_tracking_tree" />
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <xpath expr="/tree/field[@name='date']" position="after">
	                <field name="parent_id"/>
	            </xpath>
	            <xpath expr="/tree/field[@name='date']" position="after">
	                <field name="nivel"/>
	            </xpath>
	            <xpath expr="/tree/field[@name='serial']" position="replace"/>
            </field>
        </record>
    	
    	<!-- Menú de Trazabilidad -->
    	<menuitem icon="terp-mrp" id="menu_traza_root" name="Traza"
    	    groups="group_traza" sequence="5"
    	    web_icon="images/traza.png"
            web_icon_hover="images/traza-hover.png"/>
    	
    	<menuitem id="menu_traza_entradas" name="Entradas" parent="menu_traza_root" sequence="5"/>
    	
    	<!-- Vistas de los albaranes de entrada --> 
    	      
        <record id="view_picking_in_search_traza" model="ir.ui.view">
            <field name="name">stock.picking.in.search.traza</field>
            <field name="model">stock.picking</field>
            <field name="inherit_id" ref="stock.view_picking_in_search" />
            <field name="type">search</field>
            <field name="arch" type="xml">
                <xpath expr="/search/group/field[@name='origin']" position="replace"/>
                <xpath expr="/search/group/field[@name='stock_journal_id']" position="replace"/>
                <xpath expr="/search/group/field[@name='partner_id']" position="replace"/>
                <xpath expr="/search/group/field[@name='company_id']" position="replace"/>
                <xpath expr="/search/group/filter[@string='Back Orders']" position="replace"/>
                <xpath expr="/search/group/filter[@string='Available']" position="replace"/>
                <xpath expr="/search/group/filter[@string='Done']" position="replace"/>
                <xpath expr="/search/group[@string='Extended Filters...']" position="replace"/>
                <xpath expr="/search/group/filter[@string='Partner']" position="replace"/>
                <xpath expr="/search/group/filter[@string='Expected Date']" position="replace"/>
                <xpath expr="/search/group/filter[@string='Journal']" position="replace"/>
                <xpath expr="/search/group/field[@name='name']" position="after">
	                <field name="num_guia"/>
	            </xpath>
	            <xpath expr="/search/group/field[@name='name']" position="before">
	                <filter icon="terp-dialog-close" name="draft" string="Borrador" domain="[('state','=','draft')]" help="Albaranes sin validar"/>
	            </xpath>
            </field>
        </record>
        
        <record id="view_picking_in_form_traza" model="ir.ui.view">
	        <field name="name">view.picking.in.form_traza</field>
	        <field name="model">stock.picking</field>
	        <field name="inherit_id" ref="stock.view_picking_in_form" />
	        <field name="type">form</field>
	        <field name="arch" type="xml">
	            <data>
	                <xpath expr="/form/group/group/field[@name='origin']" position="replace"/>
	                <xpath expr="/form/group/group/field[@name='address_id']" position="replace"/>
	                <xpath expr="/form/group/group/field[@name='backorder_id']" position="replace"/>
	                <xpath expr="/form/group/group[2]/field[@name='stock_journal_id']" position="replace"/>
	                <xpath expr="/form/group/group/field[@name='invoice_state']" position="attributes">
		                <attribute name="invisible">1</attribute>
		            </xpath>
		            <xpath expr="/form/group/group/field[@name='min_date']" position="attributes">
		                <attribute name="invisible">1</attribute>
		            </xpath>
		            <xpath expr="/form/group" position="after">
		                <group  colspan="4" col="4">
		                	<field name="num_guia"/>
			                <field name="consum_hab_id"/>
			                <field name="num_catalog"/>
			                <field name="resp_explot_id"/>
			                <field name="dir_facul_id"/>
			                <field name="artillero_id"/>
			            </group>
		            </xpath>
		            <xpath expr="/form/notebook/page/field/tree[@string='Stock Moves']" position="attributes">
		                <attribute name="editable">bottom</attribute>
		            </xpath>
		            <xpath expr="/form/notebook/page/field/tree/field[@name='product_id']" position="attributes">
		                <attribute name="on_change">onchange_product_id(product_id,location_id,location_dest_id, parent.address_id)</attribute>
		            </xpath>
		            <xpath expr="/form/notebook/page/field/tree/field[@name='product_id']" position="before">
		                <field name="serial"/>
		            </xpath>
		            <xpath expr="/form/notebook/page/field/tree/field[@name='state']" position="before">
		                <field name="date_expected" string="Fecha"/>
		            </xpath>
		            <!-- we need to have the "name" field in the tree view, because it is a required field that is set by the on_change on product_id... otherwise we get an error message when adding a new move line via the editable tree view -->
		            <xpath expr="/form/notebook/page/field/tree/field[@name='product_id']" position="after">
		                <field name="name" invisible="1"/>
		            </xpath>
		            <xpath expr="/form/notebook/page/field/tree/field[@name='product_qty']" position="attributes">
		                <attribute name="on_change">onchange_quantity(product_id, product_qty, product_uom, product_uos)</attribute>
		            </xpath>
		            <xpath expr="/form/notebook/page/field/tree/field[@name='prodlot_id']" position="replace"/>
		            <xpath expr="/form/notebook/page/field/tree/button[@name='%(stock.track_line)d']" position="replace"/>
		            <xpath expr="/form/notebook/page[@string='Additional Info']" position="attributes">
		                <attribute name="invisible">1</attribute>
		            </xpath>
		            <xpath expr="/form/group/field[@name='artillero_id']" position="after">
	                	<field name="location_dest_id" string="Polvorín/Almacén/Stock" domain="[('polvorin', '=', True)]"/>
		            </xpath>
		            <xpath expr="/form/notebook" position="before">
		                <group  colspan="2" col="2">
	                		<button name="polvorin_to_moves" states="draft" string="Asignar el anterior polvorín/almacén/stock a todos los movimientos" type="object" icon="gtk-media-play"/>
	                	</group>
		            </xpath>
		            <xpath expr="/form/notebook" position="before">
		                <group  colspan="2" col="2">
	                		<button name="date_to_moves" states="draft" string="Asignar la fecha del albarán a todos los movimientos" type="object" icon="gtk-media-play"/>
	                	</group>
		            </xpath>
		            <xpath expr="/form/notebook/page/group/button[@name='action_process']" position="after">
                    	<button name="action_reopen" type="object" states="done,cancel,assigned,confirmed" string="Reabrir" icon="gtk-convert"/>
                	</xpath>
                	<xpath expr="/form/notebook/page/group/button[@name='draft_force_assign']" position="replace"/>
		        </data>
	        </field>
	    </record>
	    
        <record id="view_picking_in_tree_traza" model="ir.ui.view">
            <field name="name">view.picking.in.tree.traza</field>
            <field name="model">stock.picking</field>
            <field name="inherit_id" ref="stock.view_picking_in_tree" />
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <data>
                    <xpath expr="/tree/field[@name='origin']" position="replace"/>
                    <xpath expr="/tree/field[@name='partner_id']" position="replace"/>
                    <xpath expr="/tree/field[@name='backorder_id']" position="replace"/>
                    <xpath expr="/tree/field[@name='min_date']" position="replace"/>
                    <xpath expr="/tree/field[@name='invoice_state']" position="replace"/>
                    <xpath expr="/tree/field[@name='stock_journal_id']" position="replace"/>
                    <xpath expr="/tree/field[@name='name']" position="after">
		                <field name="num_guia"/>
		            </xpath>
		        </data>
            </field>
        </record>
        
        <record id="action_incoming_picking_traza" model="ir.actions.act_window">
            <field name="name">Guías de Circulación - Albaranes de Entrada</field>
            <field name="res_model">stock.picking</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="domain">[('type','=','in')]</field>
            <field name="context">{'contact_display': 'partner_address', 'type':'in'}</field>
            <field name="search_view_id" ref="view_picking_in_search_traza"/>
        </record>
        <record id="action_incoming_picking_traza1" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_picking_in_tree_traza"/>
            <field name="act_window_id" ref="action_incoming_picking_traza"/>
        </record>
        <record id="action_incoming_picking_traza2" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_picking_in_form_traza"/>
            <field name="act_window_id" ref="action_incoming_picking_traza"/>
        </record>
        <record id="action_incoming_picking_traza3" model="ir.actions.act_window.view">
            <field eval="3" name="sequence"/>
            <field name="view_mode">calendar</field>
            <field name="act_window_id" ref="action_incoming_picking_traza"/>
        </record>
        
        <menuitem id="menu_traza_entradas_guias" name="Guías de Circulación - Albaranes de Entrada " parent="menu_traza_entradas" sequence="10" action="action_incoming_picking_traza"/>
        
    	
    	<!-- Vistas de los movimientos de entrada -->
    	        
        <record id="view_move_tree_reception_traza" model="ir.ui.view">
            <field name="name">stock.move.tree.traza</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_tree_reception_picking" />
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <xpath expr="/tree/field[@name='origin']" position="replace"/>
                <xpath expr="/tree/field[@name='partner_id']" position="replace"/>
                <xpath expr="/tree/field[@name='prodlot_id']" position="replace"/>
                <xpath expr="/tree/button[@name='%(stock.move_scrap)d']" position="replace"/>
                <xpath expr="/tree/button[@name='%(stock.track_line)d']" position="replace"/>
                <xpath expr="/tree/button[@name='%(stock.split_into)d']" position="replace"/>
                <xpath expr="/tree/button[@name='setlast_tracking']" position="replace"/>
                <xpath expr="/tree/field[@name='product_id']" position="after">
	                <field name="serial"/>
	            </xpath>
            </field>
        </record>
        
        <record id="view_move_form_reception_traza" model="ir.ui.view">
            <field name="name">stock.move.form.traza</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_form" />
            <field name="type">form</field>
            <field name="arch" type="xml">
                <xpath expr="/form/group/button[@name='%(stock.move_scrap)d']" position="replace"/>
                <xpath expr="/form/group/button[@name='%(stock.split_into)d']" position="replace"/>
                <xpath expr="/form/group/field[@name='prodlot_id']" position="replace"/>
                <xpath expr="/form/group/field[@name='address_id']" position="replace"/>
                <xpath expr="/form/group/field[@name='create_date']" position="replace"/>
                <xpath expr="/form/group/field[@name='date_expected']" position="replace"/>
                <xpath expr="/form/group/field[@name='date']" position="replace"/>
                <xpath expr="/form/group/button[@name='%(stock.track_line)d']" position="replace"/>
                <xpath expr="/form/group/field[@name='picking_id']" position="replace"/>
                <xpath expr="/form/group/field[@name='tracking_id']" position="replace"/>
                <xpath expr="/form/group/separator[@string='Move Information']" position="replace"/>
                <xpath expr="/form/group/separator[@string='Dates']" position="replace"/>
                <xpath expr="/form/group/separator[@string='Picking']" position="replace"/>
                <xpath expr="/form/group/separator[@string='Traceability']" position="replace"/>
                <xpath expr="/form/group/field[@name='name']" position="attributes">
	                <attribute name="invisible">1</attribute>
	            </xpath>
                <xpath expr="/form/group/field[@name='location_id']" position="before">
	                <field name="serial"/>
	            </xpath>
	            <xpath expr="/form/field[@name='state']" position="before">
	                <field name="date"/>
	            </xpath>
	            <xpath expr="/form/field[@name='state']" position="before">
	                <field name="picking_id"/>
	            </xpath>
	            <xpath expr="/form/field[@name='state']" position="before">
	                <field name="tracking_id"/>
	            </xpath>
            </field>
        </record>

        <record id="view_move_search_reception_incoming_traza" model="ir.ui.view">
            <field name="name">stock.move.incoming.search.traza</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_search_reception_incoming_picking" />
            <field name="type">search</field>
            <field name="arch" type="xml">
            	<xpath expr="/search/group/filter[@string='To Do']" position="replace">
	                <filter icon="terp-gtk-go-back-rtl" name="draft" string="Borrador" domain="[('state','=','draft')]"/>
	            </xpath>
	            <xpath expr="/search/group/filter[@string='Supplier']" position="replace"/>
	            <xpath expr="/search/group/filter[@string='Order']" position="replace"/>
	            <xpath expr="/search/group[@string='Extended Filters...']" position="replace"/>
            	<xpath expr="/search/group/field[@name='origin']" position="replace"/>
            	<xpath expr="/search/group/field[@name='partner_id']" position="replace"/>
                <xpath expr="/search/group/field[@name='product_id']" position="after">
	                <field name="serial"/>
	            </xpath>
	            <xpath expr="/search/group/field[@name='product_id']" position="after">
	                <field name="tracking_id" context="{'tracking_id': self}"/>
	            </xpath>
            </field>
        </record>
              
        <record id="action_incoming_product_traza" model="ir.actions.act_window">
            <field name="name">Entradas</field>
            <field name="res_model">stock.move</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state','in',('confirmed','assigned','draft','done','waiting')),'|','&amp;',('picking_id','=',False),('location_id.usage', 'in', ['customer','supplier']),'&amp;',('picking_id','!=',False),('picking_id.type','=','in')]</field>
            <field name="context">{'type':'in'}</field>
            <field name="view_id" ref="view_move_tree_reception_traza"/>
            <field name="search_view_id" ref="view_move_search_reception_incoming_traza"/>
            <field name="help">Aqui puedes recibir productos individuales, sin importar a que albaran pertenezcan.</field>
        </record>
        
        <!--<menuitem id="menu_traza_entradas_entradas" name="Entradas" parent="menu_traza_entradas" sequence="5" action="action_incoming_product_traza"/>
                
         Vistas de los movimientos de salida 
        
        <menuitem id="menu_traza_consumos" name="Consumos/Salidas" parent="menu_traza_root" sequence="10"/>-->
        
        <record id="view_move_search_outgoing_traza" model="ir.ui.view">
            <field name="name">stock.move.outgoing.search.traza</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_search_reception_outcoming_picking" />
            <field name="type">search</field>
            <field name="arch" type="xml">
                <xpath expr="/search/group/field[@name='origin']" position="replace"/>
            	<xpath expr="/search/group/field[@name='partner_id']" position="replace"/>
                <xpath expr="/search/group/field[@name='prodlot_id']" position="replace"/>
                <xpath expr="/search/group/field[@name='product_id']" position="after">
	                <field name="serial"/>
	            </xpath>
	            <xpath expr="/search/group/field[@name='product_id']" position="after">
	                <field name="tracking_id" context="{'tracking_id': self}"/>
	            </xpath>
            </field>
        </record>
        
        <record id="action_outgoing_product_traza" model="ir.actions.act_window">
            <field name="name">Consumos/Salidas</field>
            <field name="res_model">stock.move</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state','in',('confirmed','assigned','draft','done','waiting')),'|','&amp;',('picking_id','=',False),('location_dest_id.usage', 'in', ['customer','supplier']),'&amp;',('picking_id','!=',False),('picking_id.type','=','out')]</field>
            <field name="context">{'type':'out'}</field>
            <field name="view_id" ref="view_move_tree_reception_traza"/>
            <field name="search_view_id" ref="view_move_search_outgoing_traza"/>
        </record>
        
        <!--<menuitem id="menu_traza_consumos_consumos" name="Consumos/Salidas" parent="menu_traza_consumos" sequence="5" action="action_outgoing_product_traza"/>
        
        
 Vistas de las devoluciones 
        
        <record id="view_move_tree_outgoing_traza" model="ir.ui.view">
            <field name="name">stock.move.tree.outgoing.traza</field>
            <field name="model">stock.move</field>
            <field name="type">tree</field>
            <field name="priority" eval="2" />
            <field name="arch" type="xml">
                <tree colors="grey:state in ('cancel');red:(state not in ('cancel','done'))" string="Moves">
                    <field name="product_id" string="Producto"/>
                    <field name="serial" string="Código producto"/>
                    <field name="product_qty" string="Cantidad consumida"/>
                    <field name="product_uom" string="Unidad"/>
                    <field name="date" string="Fecha consumo"/>
                    <field name="picking_id" string="Guía de circulación"/>
                    <field name="num_catalog" string="Número catalogación"/>
                    <field name="artillero_id" string="Artillero"/>
                    <field name="resp_explot_id" string="Responsable explotación"/>
                    <field name="dir_facul_id" string="Director facultativo"/>
                    <field name="consum_hab_id" string="Consumidor habitual de explosivos"/>
                </tree>
            </field>
        </record>
        
        <record id="view_move_form_outgoing_traza" model="ir.ui.view">
            <field name="name">stock.move.form.outgoing.traza</field>
            <field name="model">stock.move</field>
            <field name="type">form</field>
            <field name="priority" eval="2"/>
            <field name="arch" type="xml">
                <form string="Consumo/Salida de productos">
                    <group colspan="4" col="4">
                        <field name="product_id" on_change="onchange_product_id(product_id,location_id,location_dest_id, False)"/>
                        <field name="serial" string="Código producto"/>
                        <field name="product_qty" on_change="onchange_quantity(product_id, product_qty, product_uom, product_uos)"/>
                        <field name="product_uom" string="Unidad"/>
                        <newline/>
                        <separator colspan="4" string="Información de la Guía"/>
                        <field name="picking_id" string="Guía de circulación"/>
                        <field name="date"/>
                    	<field name="partner_id" string="Proveedor"/>
                    	<field name="num_catalog" string="Número catalogación"/>
                    	<separator colspan="4" string="Otros Datos"/>
	                    <field name="artillero_id" string="Artillero"/>
	                    <field name="resp_explot_id" string="Responsable explotación"/>
	                    <field name="dir_facul_id" string="Director facultativo"/>
	                    <field name="consum_hab_id" string="Consumidor explosivos"/>
                        <field name="location_id" invisible="1"/>
                        <field name="location_dest_id" invisible="1"/>
                        <field name="name" string="Reason" invisible="1"/>
	                </group>
                </form>
            </field>
        </record>

        <record id="view_move_search_outgoing_traza" model="ir.ui.view">
            <field name="name">stock.move.outgoing.search.traza</field>
            <field name="model">stock.move</field>
            <field name="type">search</field>
            <field name="priority" eval="2"/>
            <field name="arch" type="xml">
                <search string="Consumo/Salida de productos">
                    <group col="8" colspan="4">
                        <filter icon="terp-go-today" string="Today" domain="[('date','&lt;=',time.strftime('%%Y-%%m-%%d 23:59:59')),('date','&gt;=',time.strftime('%%Y-%%m-%%d 00:00:00'))]" help="Orders planned for today"/>
                        <separator orientation="vertical"/>
                        <field name="product_id"/>
                        <field name="picking_id" string="Guía de circulación"/>
                        <field name="date"/>
                        <field name="partner_id" string="Proveedor"/>
                        <field name="artillero_id"/>
                        <field name="dir_facul_id"/>
                        <field name="resp_explot_id"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By..." colspan="4" col="8" groups="base.group_extended">
                        <filter string="Supplier" icon="terp-personal" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="Product" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'product_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Guía de circulación" icon="terp-gtk-jump-to-rtl" domain="[]" context="{'group_by':'picking_id'}"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Order Date" icon="terp-go-month" domain="[]" context="{'group_by':'date'}" />
                    </group>
                </search>
            </field>
        </record>
        
        <record id="action_outgoing_product_traza" model="ir.actions.act_window">
            <field name="name">Devoluciones</field>
            <field name="res_model">stock.move</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state','in',('confirmed','assigned','draft','done','waiting')),'|','&amp;',('picking_id','=',False),('location_dest_id.usage', 'in', ['customer','supplier']),'&amp;',('picking_id','!=',False),('picking_id.type','=','out')]</field>
            <field name="context">{'type':'return'}</field>
            <field name="view_id" ref="view_move_tree_outgoing_traza"/>
        </record>
        
        <menuitem id="menu_traza_consumos_devoluciones" name="Devoluciones" parent="menu_traza_consumos" sequence="2" action="action_devol_product_traza"/>
        
        -->
        
        <!-- Vistas de las actas de consumo -->
        
        <menuitem id="menu_traza_actas" name="Actas de Consumo" parent="menu_traza_root" sequence="15"/>
        
        <record id="iso_traza_acta_view_tree" model="ir.ui.view">
            <field name="name">iso.traza.acta.tree</field>
            <field name="model">iso.traza.acta</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Actas de Consumo">
                    <field name="name" string="Nombre"/>
                    <field name="date" string="Fecha"/>
                    <field name="artillero_id" string="Artillero"/>
                    <field name="resp_explot_id" string="Responsable explotación"/>
                    <field name="consum_hab_id" string="Consumidor habitual de explosivos"/>
                    <field name="obra_id" string="Obra"/>
                    <field name="resp_equipo_id" string="Responsable del Equipo de Trabajo o Voladura"/>
                    <field name="resp_libros_id" string="Responsable de la LLevanza de los Libros"/>
                </tree>
            </field>
        </record>
        
        <record id="iso_traza_acta_view_form" model="ir.ui.view">
            <field name="name">iso.traza.acta.form</field>
            <field name="model">iso.traza.acta</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Acta de Consumo">
                    <group colspan="4" col="4">
                        <field name="name" string="Nombre"/>
	                    <field name="date" string="Fecha"/>
	                    <field name="obra_id" string="Obra"/>
	                    <field name="num_acta" string="Número de Acta"/>
	                    <field name="artillero_id" string="Artillero"/>
	                    <field name="resp_explot_id" string="Responsable explotación"/>
	                    <field name="consum_hab_id" string="Consumidor habitual de explosivos"/>
	                    <field name="dir_facul_id" string="Director Facultativo"/>
	                    <field name="resp_equipo_id" string="Responsable del Equipo de Trabajo o Voladura"/>
                    	<field name="resp_libros_id" string="Responsable de la LLevanza de los Libros"/>
	                </group>
	                <group  colspan="4" col="2">
	                    <button name="obra_to_moves" string="Asignar la obra a todos los movimientos" type="object" icon="gtk-media-play"/>
	                    <button name="date_to_moves" string="Asignar la fecha del acta a todos los movimientos" type="object" icon="gtk-media-play"/>
	                </group>
	                <field colspan="4" name="moves_ids" nolabel="1" widget="one2many_list">
                        <tree string="Movimientos">
				            <field name="product_id" string="Producto"/>
				            <field name="serial" string="Número de dentificación"/>
				            <field name="product_qty" string="Cantidad"/>
				            <field name="product_uom" string="Unidad"/>
				            <field name="date" string="Fecha"/>
				            <field name="location_id"/>
			                <field name="location_dest_id"/>
			                <field name="tracking_id"/>
			                <field name="state"/>
                        </tree>
                        <form string="Movimiento">
				            <group colspan="4" col="4">
				                <field name="product_id" on_change="onchange_product_id(product_id,location_id,location_dest_id)"/>
				                <field name="serial" string="Número de dentificación"/>
				                <field name="product_qty" on_change="onchange_quantity(product_id, product_qty, product_uom, product_uos)"/>
				                <field name="product_uom" string="Unidad"/>
				                <field name="date"/>
				                <field name="location_id"/>
				                <field name="location_dest_id"/>
				                <field name="tracking_id"/>
				                <field name="state"/>
				                <field name="name" string="Reason" invisible="1"/>
					        </group>
                        </form>
                    </field>
                    <group  colspan="4" col="3">
                    	<button name="action_done_moves" string="Poner como realizados todos los consumos o movimientos de salida" type="object" icon="gtk-media-play"/>
                    	<button name="regenerar_acta" string="Regenerar Acta para buscar productos no existentes" type="object" icon="gtk-media-play"/>
                    	<button name="action_reopen_acta" type="object" string="Poner los movimientos del acta como Borrador" icon="gtk-convert"/>
                    </group>
                </form>
            </field>
        </record>

        <record id="iso_traza_acta_view_search" model="ir.ui.view">
            <field name="name">iso.traza.acta.search</field>
            <field name="model">iso.traza.acta</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Actas de Consumo">
                    <group col="8" colspan="4">
                        <filter icon="terp-go-today" string="Hoy" domain="[('date','&lt;=',time.strftime('%%Y-%%m-%%d 23:59:59')),('date','&gt;=',time.strftime('%%Y-%%m-%%d 00:00:00'))]" help="Actas de Consumo de hoy"/>
                        <separator orientation="vertical"/>
                        <field name="name" string="Código"/>
                        <field name="date"/>
                        <field name="artillero_id"/>
                        <field name="resp_explot_id"/>
                        <field name="resp_equipo_id"/>
                    	<field name="resp_libros_id"/>
                        <field name="consum_hab_id"/>
                        <field name="obra_id" string="Obra"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By..." colspan="4" col="4">
                        <filter string="Artillero" icon="terp-personal" domain="[]" context="{'group_by':'artillero_id'}"/>
                        <filter string="Responsable explotación" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'resp_explot_id'}"/>
                        <filter string="Consumidor habitual de explosivos" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'consum_hab_id'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <record id="action_iso_traza_acta" model="ir.actions.act_window">
            <field name="name">Actas de Consumo</field>
            <field name="res_model">iso.traza.acta</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="iso_traza_acta_view_tree"/>
        </record>
        
        <menuitem id="menu_traza_actas_actas" name="Actas de Consumo" parent="menu_traza_actas" sequence="5" action="action_iso_traza_acta"/>
        
        <!-- Vistas de los libros de registro -->
        
        <!--  <menuitem id="menu_traza_libros" name="Libros de Registro" parent="menu_traza_root" sequence="20"/>    -->
        
        <!--  <record id="iso_traza_libro_view_tree" model="ir.ui.view">
            <field name="name">iso.traza.libro.tree</field>
            <field name="model">iso.traza.libro</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Libros de Registro">
                    <field name="name" string="Nombre"/>
                    <field name="date" string="Fecha de Inicio"/>
                    <field name="dir_facul_id" string="Director facultativo"/>
                    <field name="resp_explot_id" string="Responsable explotación"/>
                    <field name="obra_id" string="Obra"/>
                </tree>
            </field>
        </record>    -->
        
        <!--  <record id="iso_traza_libro_view_form" model="ir.ui.view">
            <field name="name">iso.traza.libro.form</field>
            <field name="model">iso.traza.libro</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Libro de Registro">
                    <group colspan="4" col="4">
                        <field name="name" string="Nombre"/>
	                    <field name="date" string="Fecha"/>
	                    <field name="dir_facul_id" string="Director facultativo"/>
	                    <field name="resp_explot_id" string="Responsable explotación"/>
	                    <field name="obra_id" string="Obra"/>
	                    <field colspan="4" name="moves_ids" nolabel="1" widget="one2many_list">
                            <tree string="Movimientos">
			                    <field name="product_id" string="Producto"/>
			                    <field name="serial" string="Código producto"/>
			                    <field name="product_qty" string="Cantidad recibida"/>
			                    <field name="product_uom" string="Unidad"/>
			                    <field name="date" string="Fecha recepción"/>
			                    <field name="picking_id" string="Guía de circulación"/>
			                    <field name="partner_id" string="Proveedor"/>
			                    <field name="num_catalog" string="Número catalogación"/>
			                    <field name="artillero_id" string="Artillero"/>
			                    <field name="resp_explot_id" string="Responsable explotación"/>
			                    <field name="dir_facul_id" string="Director facultativo"/>
			                    <field name="consum_hab_id" string="Consumidor habitual de explosivos"/>
                            </tree>
                            <form string="Movimiento">
			                    <group colspan="4" col="4">
			                        <field name="product_id"/>
			                        <field name="serial" string="Código producto"/>
			                        <field name="product_qty"/>
			                        <field name="product_uom" string="Unidad"/>
			                        <newline/>
			                        <separator colspan="4" string="Información de la Guía"/>
			                        <field name="picking_id" string="Guía de circulación"/>
			                        <field name="date"/>
			                    	<field name="partner_id" string="Proveedor"/>
			                    	<field name="num_catalog" string="Número catalogación"/>
			                    	<separator colspan="4" string="Otros Datos"/>
				                    <field name="artillero_id" string="Artillero"/>
				                    <field name="resp_explot_id" string="Responsable explotación"/>
				                    <field name="dir_facul_id" string="Director facultativo"/>
				                    <field name="consum_hab_id" string="Consumidor explosivos"/>
			                        <field name="location_id" invisible="1"/>
			                        <field name="location_dest_id" invisible="1"/>
			                        <field name="name" string="Reason" invisible="1"/>
				                </group>
                            </form>
                        </field>
	                </group>
                </form>
            </field>
        </record> -->

        <!--  <record id="iso_traza_libro_view_search" model="ir.ui.view">
            <field name="name">iso.traza.libro.search</field>
            <field name="model">iso.traza.libro</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Libros de Registro">
                    <group col="8" colspan="4">
                        <filter icon="terp-go-today" string="Hoy" domain="[('date','&lt;=',time.strftime('%%Y-%%m-%%d 23:59:59')),('date','&gt;=',time.strftime('%%Y-%%m-%%d 00:00:00'))]" help="Actas de Consumo de hoy"/>
                        <separator orientation="vertical"/>
                        <field name="name" string="Código"/>
                        <field name="date"/>
                        <field name="dir_facul_id"/>
                        <field name="resp_explot_id"/>
                        <field name="obra_id" string="Obra"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By..." colspan="4" col="4">
                        <filter string="Director facultativo" icon="terp-personal" domain="[]" context="{'group_by':'dir_facul_id'}"/>
                        <filter string="Responsable explotación" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'resp_explot_id'}"/>
                    </group>
                </search>
            </field>
        </record> -->
        
        <!-- <record id="action_iso_traza_libro" model="ir.actions.act_window">
            <field name="name">Libros de Registro</field>
            <field name="res_model">iso.traza.libro</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="iso_traza_libro_view_tree"/>
        </record> -->
        
        <!--  <menuitem id="menu_traza_libro_libros" name="Libros de Registro" parent="menu_traza_libros" sequence="5" action="action_iso_traza_libro"/>   -->
        
        <!-- Trazabilidad de los movimientos de stock -->
        
        <record id="view_move_tree_traza" model="ir.ui.view">
            <field name="name">view.move.tree.traza</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_tree" />
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <xpath expr="/tree/field[@name='origin']" position="replace"/>
                <xpath expr="/tree/field[@name='partner_id']" position="replace"/>
                <xpath expr="/tree/field[@name='prodlot_id']" position="replace"/>
                <xpath expr="/tree/field[@name='date']" position="replace"/>
                <xpath expr="/tree/field[@name='date_expected']" position="replace">
                    <field name="date_expected" string="Fecha"/>
                </xpath>
                <xpath expr="/tree/field[@name='picking_id']" position="replace">
                    <field name="picking_id" string="Albarán de Entrada"/>
                </xpath>
                <xpath expr="/tree/field[@name='picking_id']" position="after">
	                <field name="acta_id" string="Acta de Consumo"/>
	            </xpath>
                <xpath expr="/tree/button[@name='%(stock.move_scrap)d']" position="replace"/>
                <xpath expr="/tree/button[@name='%(stock.track_line)d']" position="replace"/>
                <xpath expr="/tree/button[@name='%(stock.split_into)d']" position="replace"/>
                <xpath expr="/tree/button[@name='setlast_tracking']" position="replace"/>
                <xpath expr="/tree/field[@name='product_id']" position="after">
	                <field name="serial"/>
	            </xpath>
            </field>
        </record>
        
        <record id="view_move_search_traza" model="ir.ui.view">
            <field name="name">stock.move.search.traza</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_search" />
            <field name="type">search</field>
            <field name="arch" type="xml">
            	<xpath expr="/search/group/field[@name='origin']" position="replace"/>
            	<xpath expr="/search/group/field[@name='address_id']" position="replace"/>
                <xpath expr="/search/group/field[@name='prodlot_id']" position="replace"/>
                <xpath expr="/search/group/filter[@name='groupby_prodlot_id']" position="replace"/>
                <xpath expr="/search/group/field[@name='product_id']" position="after">
	                <field name="serial"/>
	            </xpath>
	            <xpath expr="/search/group[@string='Extended Filters...']" position="attributes">
	                <attribute name="expand">1</attribute>
	            </xpath>
	            <xpath expr="/search/group[@string='Group By...']" position="attributes">
	                <attribute name="expand">1</attribute>
	            </xpath>
            </field>
        </record>
        
        <record id="action_move_form2_traza" model="ir.actions.act_window">
            <field name="name">Trazabilidad Completa</field>
            <field name="res_model">stock.move</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="view_move_tree_traza"/>
            <field name="search_view_id" ref="view_move_search_traza"/>
            <field name="help">Este menu le proporciona la trazabilidad completa de cualquier movimiento.</field>
        </record>
        
        <menuitem id="menu_traceability_traza" name="Trazabilidad" parent="menu_traza_root" sequence="25"/>
        
        <menuitem action="action_move_form2_traza" id="menu_action_move_form2_traza" parent="menu_traceability_traza" sequence="10"/>
        
        <!-- Modificar vistas de stock_partial_move para quitar prodlot_id -->
        
        <record id="stock_move_memory_tree_in_traza" model="ir.ui.view">
            <field name="name">stock.move.memory.tree.traza</field>
            <field name="model">stock.move.memory.in</field>
            <field name="inherit_id" ref="stock.stock_move_memory_tree_in" />
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <xpath expr="/tree/field[@name='prodlot_id']" position="replace"/>
                <xpath expr="/tree/field[@name='quantity']" position="replace">
                     <field name="quantity" digits="(14, 3)"/>
                </xpath>
            </field>
        </record>
        
        <record id="stock_move_memory_form_in_traza" model="ir.ui.view">
            <field name="name">stock.move.memory.form.traza</field>
            <field name="model">stock.move.memory.in</field>
            <field name="inherit_id" ref="stock.stock_move_memory_form_in" />
            <field name="type">form</field>
            <field name="arch" type="xml">
                <xpath expr="/tree/field[@name='prodlot_id']" position="replace"/>
                <xpath expr="/tree/field[@name='quantity']" position="replace">
                     <field name="quantity" digits="(14, 3)"/>
                </xpath>
            </field>
        </record>   
        
        <record id="stock_move_memory_tree_out_traza" model="ir.ui.view">
            <field name="name">stock.move.memory.tree.traza</field>
            <field name="model">stock.move.memory.out</field>
            <field name="inherit_id" ref="stock.stock_move_memory_tree_out" />
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <xpath expr="/tree/field[@name='prodlot_id']" position="replace"/>
                <xpath expr="/tree/field[@name='quantity']" position="replace">
                     <field name="quantity" digits="(14, 3)"/>
                </xpath>
            </field>
        </record>
        
        <record id="stock_move_memory_form_out_traza" model="ir.ui.view">
            <field name="name">stock.move.memory.form.traza</field>
            <field name="model">stock.move.memory.out</field>
            <field name="inherit_id" ref="stock.stock_move_memory_form_out" />
            <field name="type">form</field>
            <field name="arch" type="xml">
                <xpath expr="/tree/field[@name='prodlot_id']" position="replace"/>
                <xpath expr="/tree/field[@name='quantity']" position="replace">
                     <field name="quantity" digits="(14, 3)"/>
                </xpath>
            </field>
        </record>
        
        <!-- Artilleros -->
        
        <record id="iso_traza_artillero_view_tree" model="ir.ui.view">
            <field name="name">iso.traza.artillero.tree</field>
            <field name="model">iso.traza.artillero</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Artilleros">
                    <field name="name"/>
                    <field name="dni"/>
                    <field name="cartilla"/>                   
					<field name="username"/>
                    <field name="password"/>     
                </tree>
            </field>
        </record>
        
        <record id="iso_traza_artillero_view_form" model="ir.ui.view">
            <field name="name">iso.traza.artillero.form</field>
            <field name="model">iso.traza.artillero</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Artillero">
                    <group colspan="6" col="6">
                        <field name="name"/>
                        <field name="dni"/>
                        <field name="cartilla"/>
					</group>                        
					<group colspan="4" col="4">                        
						<field name="username"/>
                        <field name="password"/>                        
	                </group>
                </form>
            </field>
        </record>

        <record id="iso_traza_artillero_view_search" model="ir.ui.view">
            <field name="name">iso.traza.artillero.search</field>
            <field name="model">iso.traza.artillero</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Artilleros">
                    <group col="8" colspan="4">
                        <field name="name"/>
                        <field name="dni"/>
                        <field name="cartilla"/>
                    </group>
                </search>
            </field>
        </record>
        	
        <record id="action_artilleros" model="ir.actions.act_window">
            <field name="name">Artilleros</field>
            <field name="res_model">iso.traza.artillero</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="iso_traza_artillero_view_tree"/>
            <field name="search_view_id" ref="iso_traza_artillero_view_search"/>
        </record>
        	        
		<menuitem action="action_artilleros" id="menu_action_artilleros" parent="menu_traceability_traza" sequence="20"/>
		
		<!-- Polvorín - Almacén - Stock -->
        	
        <record id="action_polvorin" model="ir.actions.act_window">
            <field name="name">Polvorines - Almacenes - Stocks</field>
            <field name="res_model">stock.location</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="domain">[('polvorin','=',True)]</field>
            <field name="view_id" ref="view_location_tree2_traza"/>
            <field name="search_view_id" ref="view_location_search_traza"/>
        </record>
        	        
		<menuitem action="action_polvorin" id="menu_action_polvorin" parent="menu_traceability_traza" sequence="30"/>
		
		<!-- Obra - Explotación -->
        	
        <record id="action_obra" model="ir.actions.act_window">
            <field name="name">Obra - Explotación</field>
            <field name="res_model">stock.location</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="domain">[('obra','=',True)]</field>
            <field name="view_id" ref="view_location_tree2_traza"/>
            <field name="search_view_id" ref="view_location_search_traza"/>
        </record>
        	        
		<menuitem action="action_obra" id="menu_action_obra" parent="menu_traceability_traza" sequence="40"/>
		
		<!--  Reabrir Movimientos para eliminarlos, sólo administrador -->
		
		<record id="action_reopen_mov_salida_server" model="ir.actions.server">
            <field name="name">Reabrir Movimientos</field>
            <field name="model_id" ref="model_stock_move"/>
            <field name="state">code</field>
            <field name="code">action = obj.action_reopen_mov_salida()</field>
        </record>
		
		<record id="ir_act_stock_move_reopen" model="ir.values">
            <field name="key2">client_action_multi</field>
            <field name="model">stock.move</field>
            <field name="name">Reabrir Movimientos</field>
            <field name="user_id">1</field>
            <field eval="'ir.actions.server,%d'%action_reopen_mov_salida_server" name="value"/>
            <field eval="True" name="object"/>
        </record>
		
	</data>
</openerp>